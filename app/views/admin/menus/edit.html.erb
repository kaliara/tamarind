<h2>Editing <%= @menu.name %> Menu</h3>

<%= form_for([:admin,@menu]) do |f| %>
  <div class="field">
    <%= f.label :name %>
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <%= f.label :viewable %>
    <%= f.check_box :viewable %>
  </div>
  <div class="actions">
    <%= f.submit "Update" %>
  </div>
<% end %>  


<div id="live_edit_menu" class="live_edit_menu">
  <% @menu.sections.each do |section| %>
    <h3 class="<%= 'no_name' unless section.show_name? %>"><%= section.name %></h3>
    <ul class="section <%= "two_column" if section.two_column? %>">
      <% section.items.each do |item| %>
        <li class="item">
          <%= form_for([:admin, item], :remote => true) do |f| %>
            <%= f.hidden_field :position %>
            <%= link_to "Details", edit_admin_item_path(item), :class => "edit_menu_item" %>
            <h4><%= f.text_field :name %></h4>
            <div class="price">$<%= f.text_field :price %></div>
            <p class="description"><%= f.text_field :description %></p>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% end %>
</div>



<%= form_for([:admin, Section.new], :remote => true) do |f| %>
  <%= f.hidden_field :menu_id, :value => @menu.id %>
  <%= f.hidden_field :hidden, :value => false %>

  <div class="field">
    <%= f.label :name %>
    <%= f.text_field :name %>
  </div>
  <div class="field">
    <%= f.label :show_name %>
    <%= f.check_box :show_name %><span class="note">(uncheck to hide name on menu)</span>
  </div>
  <div class="actions">
    <%= f.submit "Add Section" %>
  </div>
<% end %>












<br><br><br>

<%= link_to 'Show', admin_menu_path(@menu) %> |
<%= link_to 'Back', admin_menus_path %>



<script type="text/javascript" charset="utf-8">
  $('.section').sortable({
    update: function(){
      $(this).find('#item_position').each(function(index, element){$(element).val(index)});
      $(this).find('form').submit();
    }
  });
  
  $('.section .item h4').click(function(){($(this).addClass('editing'))});
  $('.edit_item input').change(function(){$(this).parentsUntil('form').submit()});

  $('#new_section').submit(function(){
    $('#live_edit_menu').append('<h3>' + $('#section_name').val() + '</h3><ul class="section"></ul>');
  });
  $('#new_section').bind('ajax:success', function(){
    $(this)[0].reset(); 
  })
</script>